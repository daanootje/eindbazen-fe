<link rel="import" href="../../../../bower_components/web-socket/web-socket.html">
<link rel="import" href="../../../../bower_components/time-display/time-display.html">

<dom-module id="pa-time-display">
  <template>
    <style include="shared-styles"></style>

    <div>
      <web-socket id="websocket"
                  url="ws://127.0.0.1:8080/time_remaining"
                  auto
                  on-open="_openSocket"
                  on-message="_onMessage"
                  on-error="_onError">
      </web-socket>

      <time-display id="time" datetime="2018-06-28T12:00:00.00" format="hh:mm:ss"></time-display>

    </div>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'pa-time-display',

        toHHMMSS: function (timeInSeconds) {
          var sec_num = parseInt(timeInSeconds, 10);
          var hours   = Math.floor(sec_num / 3600);
          var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
          var seconds = sec_num - (hours * 3600) - (minutes * 60);

          if (hours   < 10) {hours   = '0'+hours;}
          if (minutes < 10) {minutes = '0'+minutes;}
          if (seconds < 10) {seconds = '0'+seconds;}
          return hours+':'+minutes+':'+seconds;
        },

        _openSocket: function (event) {
          console.log('WebSocket opened');
        },

        _onMessage: function (event) {
          this.$.time.datetime = '2018-06-28T'+this.toHHMMSS(event.detail);
        },

        _onError: function (event) {
          console.log('WebSocket error'+event.detail);
        }

      });
    })();
  </script>

</dom-module>
